# 6 ä¸ªé—®é¢˜çš„å®Œæ•´ç­”å¤

ç”Ÿæˆæ—¶é—´ï¼š2025-10-30

---

## 1. âœ… xPNTsFactory åœ°å€ç¡®è®¤

**ç­”æ¡ˆï¼šæ˜¯çš„**ï¼Œ`0xC2AFEA0F736403E7e61D3F7C7c6b4E5E63B5cab6` æ˜¯å½“å‰æœ€æ–°çš„ xPNTsFactory åœ°å€ï¼ˆSepoliaï¼‰ã€‚

- éƒ¨ç½²æ—¶é—´ï¼š2025-10-30 12:15
- çŠ¶æ€ï¼šâœ… å·²éƒ¨ç½²å¹¶åœ¨ shared-config v0.2.7 ä¸­æ›´æ–°

---

## 2. âŒ MySBT v2.3.3 **ä¸èƒ½**å®Œå…¨æ›¿ä»£ MySBTWithNFTBinding

### åŠŸèƒ½å¯¹æ¯”è¡¨ï¼š

| åŠŸèƒ½ | MySBT v2.3.3 | MySBTWithNFTBinding | å·®å¼‚è¯´æ˜ |
|------|-------------|---------------------|----------|
| **NFT ç»‘å®šåŸºç¡€åŠŸèƒ½** | âœ… æœ‰ | âœ… æœ‰ | ä¸¤è€…éƒ½æ”¯æŒ NFT ç»‘å®š |
| **åŒç»‘å®šæ¨¡å¼** | âŒ æ—  | âœ… CUSTODIAL + NON_CUSTODIAL | MySBTWithNFTBinding æ”¯æŒæ‰˜ç®¡å’Œéæ‰˜ç®¡ |
| **è§£ç»‘å†·å´æœŸ** | âŒ æ—  | âœ… 7 å¤©å†·å´ | request + execute ä¸¤æ­¥æµç¨‹ |
| **é¢å¤–è´¨æŠ¼æœºåˆ¶** | âŒ æ—  | âœ… 11+ ç»‘å®šéœ€é¢å¤–è´¨æŠ¼ | è¶…è¿‡ 10 ä¸ªç»‘å®šï¼Œæ¯ä¸ªé¢å¤– 1 stGT |
| **Burn ä¿æŠ¤** | âš ï¸ ç®€å•æ£€æŸ¥ | âœ… å¼ºåˆ¶è§£ç»‘æ‰€æœ‰ NFT | æ›´å®‰å…¨çš„é€€å‡ºæœºåˆ¶ |
| **ç”¨é€”** | åè®®æ ¸å¿ƒ SBT | ç¤¾åŒºè‡ªå®šä¹‰ SBT | ä¸åŒçš„ä½¿ç”¨åœºæ™¯ |

### âŒ ç»“è®ºï¼šä¸åº”åºŸå¼ƒ

**åŸå› **ï¼š
1. **MySBT v2.3.3**ï¼šåè®®æ ¸å¿ƒåˆçº¦ï¼Œè½»é‡çº§å®ç°
   - ç›´æ¥éƒ¨ç½²ï¼Œåè®®å®˜æ–¹ä½¿ç”¨
   - åŸºç¡€ NFT bindingï¼ˆå•ä¸€æ¨¡å¼ï¼Œå³æ—¶è§£ç»‘ï¼‰
   - burnSBT() é€€å‡ºæœºåˆ¶

2. **MySBTWithNFTBinding**ï¼šç¤¾åŒºé€šè¿‡ MySBTFactory éƒ¨ç½²
   - é‡å‹ NFT bindingï¼ˆåŒæ¨¡å¼ï¼Œå†·å´æœŸï¼Œè´¨æŠ¼é€’å¢ï¼‰
   - æ›´å¤æ‚çš„èº«ä»½ç³»ç»Ÿ
   - é€‚åˆéœ€è¦é«˜çº§åŠŸèƒ½çš„ç¤¾åŒº

**ä¸¤è€…æœåŠ¡äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œåº”è¯¥ä¿ç•™**ã€‚

---

## 3. âŒ MySBT v2.3.3 **ä¸éœ€è¦** MySBTFactory

**ç­”æ¡ˆï¼šä¸éœ€è¦**ã€‚

### ç†ç”±ï¼š

| åˆçº¦ç±»å‹ | éƒ¨ç½²æ–¹å¼ | ä½¿ç”¨åœºæ™¯ | æ˜¯å¦éœ€è¦ Factory |
|---------|---------|---------|----------------|
| **MySBT v2.3.3** | åè®®å®˜æ–¹ç›´æ¥éƒ¨ç½² | åè®®æ ¸å¿ƒ SBT | âŒ ä¸éœ€è¦ |
| **MySBTWithNFTBinding** | ç¤¾åŒºé€šè¿‡ Factory éƒ¨ç½² | ç¤¾åŒºè‡ªå®šä¹‰ SBT | âœ… éœ€è¦ï¼ˆå·²éƒ¨ç½²ï¼‰|

**è®¾è®¡åŸåˆ™**ï¼š
- åè®®æ ¸å¿ƒåˆçº¦ï¼ˆGToken, GTokenStaking, Registry, MySBT v2.3.3ï¼‰â†’ ç›´æ¥éƒ¨ç½²
- ç¤¾åŒºè‡ªå®šä¹‰åˆçº¦ï¼ˆxPNTs, MySBT with NFT bindingï¼‰â†’ Factory éƒ¨ç½²

---

## 4. âœ… PaymasterFactory åˆ†æ

### æ— è®¸å¯éƒ¨ç½²æœºåˆ¶ï¼š

**å·¥ä½œåŸç†**ï¼ˆEIP-1167 Minimal Proxyï¼‰ï¼š
```solidity
// 1. Owner æ³¨å†Œå®ç°ç‰ˆæœ¬
paymasterFactory.addImplementation("v4.1-ep0.7", paymasterV4_1Address);

// 2. ç¤¾åŒº/operator æ— è®¸å¯éƒ¨ç½²
address paymaster = paymasterFactory.deployPaymaster("v4.1-ep0.7", initData);
// â†‘ ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ï¼Œéƒ¨ç½²è‡ªå·±çš„ Paymaster proxy

// 3. Proxy æŒ‡å‘é“¾ä¸Šçš„ PaymasterV4_1 å®ç°
// Gas æˆæœ¬ï¼š~100k gas (vs ç›´æ¥éƒ¨ç½² ~3M gas)
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ— è®¸å¯ï¼šä»»ä½•ç¤¾åŒºéƒ½å¯ä»¥éƒ¨ç½²
- âœ… ä½æˆæœ¬ï¼šä½¿ç”¨ minimal proxyï¼Œgas èŠ‚çœ 97%
- âœ… å¯å‡çº§ï¼šOwner å¯æ·»åŠ æ–°ç‰ˆæœ¬å®ç°

### EntryPoint ç‰ˆæœ¬æ”¯æŒï¼š

**å½“å‰çŠ¶æ€**ï¼š
| Paymaster ç‰ˆæœ¬ | EntryPoint ç‰ˆæœ¬ | çŠ¶æ€ | éƒ¨ç½²åœ°å€ |
|--------------|----------------|------|---------|
| PaymasterV4_1 | âœ… v0.7 | å·²éƒ¨ç½² | ï¼ˆç›´æ¥éƒ¨ç½²ï¼Œæœªé€šè¿‡ Factoryï¼‰|
| PaymasterV4_0 | âŒ v0.6 | æœªå¼€å‘ | N/A |
| PaymasterV4_2 | âŒ v0.8 | æœªå¼€å‘ | N/A |

**å»ºè®®å®ç°æ–¹å¼**ï¼š

```solidity
// éƒ¨ç½² PaymasterFactory åï¼š

// 1. æ³¨å†Œ v0.7 ç‰ˆæœ¬
factory.addImplementation("v4.1-ep0.7", paymasterV4_1Address);

// 2. æœªæ¥æ‰©å±•ï¼ˆéœ€è¦å¼€å‘æ–°åˆçº¦ï¼‰ï¼š
// factory.addImplementation("v4.0-ep0.6", paymasterV4_0Address);  // å¾…å¼€å‘
// factory.addImplementation("v4.2-ep0.8", paymasterV4_2Address);  // å¾…å¼€å‘

// 3. ç¤¾åŒºæ— è®¸å¯éƒ¨ç½²
address myPaymaster = factory.deployPaymaster("v4.1-ep0.7", initData);
```

**Owner æƒé™**ï¼š
- âœ… å¯ä»¥æ·»åŠ æ–°ç‰ˆæœ¬ï¼ˆaddImplementationï¼‰
- âœ… å¯ä»¥è®¾ç½®é»˜è®¤ç‰ˆæœ¬ï¼ˆsetDefaultVersionï¼‰
- âŒ **ä¸èƒ½**æ›´æ¢å·²éƒ¨ç½² Paymaster çš„å®ç°ï¼ˆproxy æ˜¯ immutableï¼‰
- âŒ **ä¸èƒ½**æ§åˆ¶ç¤¾åŒºéƒ¨ç½²çš„ Paymasterï¼ˆowner æ˜¯ deployerï¼‰

**ç»“è®º**ï¼š
- âœ… å¯ä»¥éƒ¨ç½² PaymasterFactory å®ç°æ— è®¸å¯éƒ¨ç½²
- âš ï¸ å½“å‰åªæ”¯æŒ EntryPoint v0.7
- ğŸ”® éœ€è¦å¼€å‘ v0.6 å’Œ v0.8 ç‰ˆæœ¬

---

## 5. âœ… Faucet é¡µé¢åˆçº¦åœ°å€ - æˆ‘å®Œå…¨é”™äº†ï¼Œä½ æ˜¯å¯¹çš„

### æˆ‘çš„é”™è¯¯ï¼š

ä¹‹å‰æˆ‘è¯´ï¼š"Faucet æ˜¯ Vercel API é¡¹ç›®ï¼ŒAPI å·²æ­£ç¡®ä½¿ç”¨ shared-config 0.2.7"

**è¿™æ˜¯é”™çš„ï¼** Faucet æ˜¯**å•é¡µåº”ç”¨**ï¼ˆpublic/index.htmlï¼‰ï¼Œæœ‰å¤§é‡ç¡¬ç¼–ç çš„æ—§åœ°å€ã€‚

### éœ€è¦æ›´æ–°çš„åœ°å€ï¼š

**æ—§åœ°å€ï¼ˆéœ€åºŸå¼ƒï¼‰**ï¼š
```javascript
// public/index.html line 975-978
PNT: "0xD14E87d8D8B69016Fcc08728c33799bD3F66F180",  // âŒ æ—§ GasTokenV2
SBT: "0xBfde68c232F2248114429DDD9a7c3Adbff74bD7f",  // âŒ æ—§ MySBT
```

**æ–°åœ°å€ï¼ˆfrom @aastar/shared-config v0.2.7ï¼‰**ï¼š
```javascript
GTOKEN: "0x868F843723a98c6EECC4BF0aF3352C53d5004147",    // âœ… ä¸å˜
MYSBT: "0x3cE0AB2a85Dc4b2B1976AA924CF8047F7afA9324",    // âœ… MySBT v2.3.3
REGISTRY: "0xd8f50dcF723Fb6d0Ec555691c3a19E446a3bb765",  // âœ… Registry v2.1.3
GTOKEN_STAKING: "0xB39c0c3c7Fac671Ce26acD7Be5d81192DDc8bB27", // âœ… GTokenStaking v2
MOCK_USDT: "0x14EaC6C3D49AEDff3D59773A7d7bfb50182bCfDc",  // âœ… ä¸å˜
```

**å¾…æ›´æ–°é¡¹**ï¼š
1. JavaScript CONTRACTS å¯¹è±¡ï¼ˆline 975-978ï¼‰
2. HTML å±•ç¤ºå¡ç‰‡ï¼ˆGovernance Token, SBT, PNT ç­‰ï¼‰
3. Etherscan é“¾æ¥

---

## 6. âœ… contract-relation æ–‡æ¡£ç¼ºå¤±å†…å®¹ - ä½ å®Œå…¨æ­£ç¡®

### ç¼ºå¤± 1ï¼šGTokenStaking Locker é…ç½®ä¾èµ–

**ä½ è¯´çš„å¯¹ï¼** æ–‡æ¡£ä¸­åªæœ‰"é…ç½®æ­¥éª¤"ï¼Œä½†æ²¡æœ‰åœ¨ä¾èµ–å…³ç³»å›¾ä¸­ä½“ç°ã€‚

**åº”è¯¥è¡¥å……**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GTokenStaking â”‚
â”‚      v2       â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ ğŸ”§ configureLocker(mysbt, true, 0.1 ether, [], [], 0x0)
    â”‚    â†“ æˆæƒ MySBT ä½œä¸º Locker
    â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySBT   â”‚
â”‚  v2.3.3   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯´æ˜**ï¼š
- MySBT ä¾èµ– GTokenStakingï¼ˆæ„é€ å‚æ•°ï¼‰
- GTokenStaking éœ€è¦**é…ç½®** MySBT ä¸º Lockerï¼ˆéƒ¨ç½²åæ“ä½œï¼‰
- è¿™æ˜¯**å¾ªç¯ä¾èµ–**çš„é…ç½®å…³ç³»ï¼Œå¿…é¡»åœ¨æ–‡æ¡£ä¸­è¯´æ˜

### ç¼ºå¤± 2ï¼šxPNTsToken Auto-Approve æœºåˆ¶

**ä½ å®Œå…¨æ­£ç¡®ï¼** æˆ‘çš„æ–‡æ¡£è¯´ï¼š
- âŒ "xPNTsToken ä¸ä¾èµ– SuperPaymaster"
- âŒ "SuperPaymaster ä¸ä½œä¸ºæ„é€ å‚æ•°"

**å®é™…æƒ…å†µ**ï¼ˆxPNTsFactory.deployxPNTsToken Line 159-184ï¼‰ï¼š
```solidity
function deployxPNTsToken(
    string memory name,
    string memory symbol,
    string memory communityName,
    string memory communityENS,
    uint256 exchangeRate,
    address paymasterAOA  // ğŸ‘ˆ ç¤¾åŒºç‹¬ç«‹ Paymaster åœ°å€å‚æ•°
) external returns (address token) {
    // 1. éƒ¨ç½² xPNTs
    xPNTsToken newToken = new xPNTsToken(...);

    // 2. è‡ªåŠ¨æˆæƒ SuperPaymaster V2ï¼ˆAOA+ æ¨¡å¼ï¼‰
    newToken.addAutoApprovedSpender(SUPERPAYMASTER);

    // 3. è‡ªåŠ¨æˆæƒç¤¾åŒº Paymasterï¼ˆAOA æ¨¡å¼ï¼Œå¦‚æœæä¾›ï¼‰
    if (paymasterAOA != address(0)) {
        newToken.addAutoApprovedSpender(paymasterAOA);
    }

    return token;
}
```

**å…³é”®æœºåˆ¶**ï¼š
1. **AOA+ æ¨¡å¼**ï¼ˆå…±äº« SuperPaymasterï¼‰ï¼š
   - xPNTs è‡ªåŠ¨ approve SuperPaymaster
   - ç”¨æˆ·æ— éœ€æ‰‹åŠ¨ approveï¼Œç›´æ¥è°ƒç”¨ `SuperPaymaster.depositAPNTs()`

2. **AOA æ¨¡å¼**ï¼ˆç‹¬ç«‹ç¤¾åŒº Paymasterï¼‰ï¼š
   - é€šè¿‡ `paymasterAOA` å‚æ•°æŒ‡å®šç¤¾åŒº Paymaster V4.1 åœ°å€
   - xPNTs åŒæ—¶ approve SuperPaymaster å’Œç¤¾åŒº Paymaster
   - çµæ´»æ”¯æŒä¸¤ç§æ¨¡å¼

**æ–‡æ¡£å¿…é¡»è¡¥å……**ï¼š
- xPNTsToken éƒ¨ç½²æ—¶çš„ auto-approve é…ç½®æµç¨‹
- paymasterAOA å‚æ•°çš„ä½œç”¨å’Œå¿…è¦æ€§
- AOA vs AOA+ æ¨¡å¼çš„åŒºåˆ«

---

## æ€»ç»“

### æˆ‘çš„é”™è¯¯ï¼š
1. âŒ å¿½ç•¥äº† Faucet æ˜¯å•é¡µåº”ç”¨ï¼Œæœ‰ç¡¬ç¼–ç åœ°å€
2. âŒ æ–‡æ¡£ç¼ºå°‘ GTokenStaking Locker é…ç½®ä¾èµ–
3. âŒ æ–‡æ¡£ç¼ºå°‘ xPNTs auto-approve æœºåˆ¶
4. âŒ é”™è¯¯è®¤ä¸º xPNTsToken ä¸ä¾èµ– SuperPaymasterï¼ˆå®é™…åœ¨éƒ¨ç½²æ—¶è‡ªåŠ¨æˆæƒï¼‰

### ä½ çš„æ­£ç¡®æŒ‡å‡ºï¼š
1. âœ… Faucet é¡µé¢æœ‰æ—§åœ°å€éœ€è¦æ›´æ–°
2. âœ… contract-relation æ–‡æ¡£ç¼ºå°‘ locker é…ç½®è¯´æ˜
3. âœ… xPNTsToken éƒ¨ç½²æ—¶æœ‰ paymasterAOA å‚æ•°ç”¨äº auto-approve

### å¾…åŠäº‹é¡¹ï¼š
- [ ] æ›´æ–° faucet/public/index.html ä¸­çš„æ‰€æœ‰åˆçº¦åœ°å€
- [ ] æ›´æ–° contract-relation-2025-10-30.md è¡¥å……ç¼ºå¤±å†…å®¹
- [ ] æäº¤å¹¶æ¨é€æ‰€æœ‰æ›´æ–°

---

**æˆ‘ä¼šç«‹å³ä¿®å¤è¿™äº›é—®é¢˜ã€‚**
