# SuperPaymasterV2_3 æœ€ç»ˆéƒ¨ç½²æŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-19
**çŠ¶æ€**: âœ… éƒ¨ç½²æˆåŠŸï¼ˆä½¿ç”¨shared-config v0.3.4æ­£ç¡®åœ°å€ï¼‰

---

## âœ… éƒ¨ç½²ä¿¡æ¯

### åˆçº¦åœ°å€
**SuperPaymasterV2_3**: `0x081084612AAdFdbe135A24D933c440CfA2C983d2`

**éƒ¨ç½²äº¤æ˜“**: `0x1b2d3bb268881f2776e48a38d9d73e74b642054ea2a09ae17e65bd879af6c99d`

**Etherscan**: https://sepolia.etherscan.io/address/0x081084612AAdFdbe135A24D933c440CfA2C983d2

**Deployer**: `0x411BD567E46C0781248dbB6a9211891C032885e5`

### åˆçº¦å‚æ•°

**VERSION**: `2.3.0`

**DEFAULT_SBT**: `0xD1e6BDfb907EacD26FF69a40BBFF9278b1E7Cf5C` (MySBT)

---

## ğŸ“¦ ä½¿ç”¨çš„åœ°å€ï¼ˆæ¥è‡ª@aastar/shared-config v0.3.4ï¼‰

| åˆçº¦ | åœ°å€ | æ¥æº |
|------|------|------|
| gToken | `0x99cCb70646Be7A5aeE7aF98cE853a1EA1A676DCc` | shared-config v0.3.4 |
| gTokenStaking | `0xbEbF9b4c6a4cDB92Ac184aF211AdB13a0b9BF6c0` | shared-config v0.3.4 |
| **registry** | `0x49245E1f3c2dD99b3884ffeD410d0605Cf4dC696` | **shared-config v0.3.4** âœ… |
| ethUsdPriceFeed | `0x694AA1769357215DE4FAC081bf1f309aDC325306` | Chainlink Sepolia ETH/USD |
| defaultSBT | `0xD1e6BDfb907EacD26FF69a40BBFF9278b1E7Cf5C` | MySBT |

---

## âš™ï¸  é…ç½®çŠ¶æ€

| é…ç½®é¡¹ | åœ°å€ | çŠ¶æ€ | äº¤æ˜“Hash |
|--------|------|------|----------|
| EntryPoint | `0x0000000071727De22E5E9d8BAf0edAc6f37da032` | âœ… æˆåŠŸ | 0xe30393d1a8b81b14541204be939139ae2091aff28468108d297b6f2e97145f3c |
| aPNTsToken | `0xBD0710596010a157B88cd141d797E8Ad4bb2306b` | âœ… æˆåŠŸ | 0xafcb8da281650c1d5adf8cd436411d76f0bf78501e790a2701fe897979a6712f |
| Treasury | `0x411BD567E46C0781248dbB6a9211891C032885e5` | âš ï¸  æœªé…ç½® | - |

**æ³¨**: Treasuryé…ç½®å¯èƒ½ä¸éœ€è¦ï¼ˆåˆçº¦å¯èƒ½æ²¡æœ‰setTreasuryå‡½æ•°æˆ–åœ¨registerOperatoræ—¶è®¾ç½®ï¼‰

---

## ğŸ”‘ å…³é”®æ”¹è¿›

### 1. åœ°å€æ¥æºä¿®æ­£

**ä¹‹å‰é”™è¯¯**ï¼š
- âŒ ç¡¬ç¼–ç é”™è¯¯çš„registryåœ°å€: `0xfc1d62e41a86b11cF19Ce2C0B610bE8D58A5aa4F`
- âŒ æ¥è‡ªè¿‡æ—¶çš„docsæ–‡æ¡£

**ç°åœ¨æ­£ç¡®**ï¼š
- âœ… ä»npmåŒ… `@aastar/shared-config@0.3.4` è·å–
- âœ… ä½¿ç”¨æ­£ç¡®çš„registryåœ°å€: `0x49245E1f3c2dD99b3884ffeD410d0605Cf4dC696`
- âœ… å®˜æ–¹sourceï¼Œä¿è¯æœ€æ–°

### 2. éƒ¨ç½²æ–¹å¼æ”¹è¿›

**ä¹‹å‰å¤±è´¥**ï¼š
- âŒ `forge create` é‡åˆ° socket error
- âŒ Path too long error (node_modules)

**æˆåŠŸæ–¹æ³•**ï¼š
- âœ… åˆ é™¤node_modulesç¼©çŸ­è·¯å¾„
- âœ… ä½¿ç”¨ `forge script` è€Œé `forge create`
- âœ… éƒ¨ç½²æˆåŠŸï¼Œonchain execution complete

---

## ğŸ“Š Gasä¼˜åŒ–å›é¡¾

### V2.3æ ¸å¿ƒä¼˜åŒ–

| ç‰ˆæœ¬ | Gasæ¶ˆè€— | vs Baseline | èŠ‚çœ |
|------|---------|-------------|------|
| Baseline v1.0 | 312,008 | - | - |
| V2.2 (å½“å‰ç”Ÿäº§) | 181,679 | -41.8% | 130k gas |
| **V2.3 (æ–°éƒ¨ç½²)** | **~170,879** | **-45.2%** | **~141k gas** |

**ä¼˜åŒ–æ¥æº**ï¼š
1. `immutable DEFAULT_SBT` æ›¿ä»£åŠ¨æ€æ•°ç»„ â†’ èŠ‚çœ ~10.8k gas
2. SafeTransferFromå®‰å…¨æå‡ â†’ +200 gas
3. å‡€èŠ‚çœï¼š~10.6k gas per transaction

### æ–°åŠŸèƒ½ï¼šupdateOperatorXPNTsToken

```solidity
function updateOperatorXPNTsToken(address newXPNTsToken) external {
    if (accounts[msg.sender].stakedAt == 0) {
        revert NotRegistered(msg.sender);
    }
    if (newXPNTsToken == address(0)) {
        revert InvalidAddress(newXPNTsToken);
    }

    address oldToken = accounts[msg.sender].xPNTsToken;
    accounts[msg.sender].xPNTsToken = newXPNTsToken;

    emit OperatorXPNTsTokenUpdated(msg.sender, oldToken, newXPNTsToken);
}
```

**ç”¨é€”**: Operatorå¯çµæ´»åˆ‡æ¢tokenï¼ˆbPNT â†” xPNTï¼‰ï¼Œæ— éœ€é‡æ–°æ³¨å†Œ

---

## ğŸ”§ éƒ¨ç½²å‘½ä»¤

### å®Œæ•´éƒ¨ç½²æµç¨‹

```bash
# 1. å®‰è£…shared-configè·å–æœ€æ–°åœ°å€
pnpm install @aastar/shared-config@latest

# 2. æ›´æ–°DeployV2_3.s.solä½¿ç”¨æ­£ç¡®åœ°å€
# (å·²å®Œæˆï¼Œä½¿ç”¨shared-config v0.3.4åœ°å€)

# 3. åˆ é™¤node_modulesé¿å…è·¯å¾„è¿‡é•¿
rm -rf node_modules

# 4. ä½¿ç”¨forge scriptéƒ¨ç½²
forge script contracts/script/DeployV2_3.s.sol:DeployV2_3 \
  --rpc-url $SEPOLIA_RPC_URL \
  --broadcast \
  --legacy \
  -vv

# 5. é…ç½®EntryPointå’ŒaPNTsToken
bash scripts/deploy/configure-v2.3-final.sh
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

### ç«‹å³å¯åš

1. âœ… æŸ¥çœ‹åˆçº¦éƒ¨ç½²: https://sepolia.etherscan.io/address/0x081084612AAdFdbe135A24D933c440CfA2C983d2
2. â³ **æ³¨å†Œoperator** (0x411BD567E46C0781248dbB6a9211891C032885e5, å·²æœ‰200 GT)
3. â³ æµ‹è¯•updateOperatorXPNTsTokenåŠŸèƒ½
4. â³ è¿è¡Œgaslessäº¤æ˜“æµ‹è¯•éªŒè¯gasèŠ‚çœ

### Operatoræ³¨å†Œ

**Operatoråœ°å€**: `0x411BD567E46C0781248dbB6a9211891C032885e5`
**GTä½™é¢**: 200 GT (ç”¨æˆ·æä¾›)
**æ³¨å†ŒToken**: `0x70Da2c1B7Fcf471247Bc3B09f8927a4ab1751Ba3` (bPNT)

**æ³¨å†Œè„šæœ¬**:
```bash
# æ–¹å¼1: é€šè¿‡Registryè‡ªåŠ¨æ³¨å†Œï¼ˆæ¨èï¼‰
bash scripts/deploy/register-operator-via-registry.sh

# æ–¹å¼2: ç›´æ¥æ³¨å†Œåˆ°Paymaster
bash scripts/deploy/register-operator-direct.sh
```

**æ³¨æ„**: éœ€è¦æ›´æ–°è„šæœ¬ä¸­çš„PAYMASTER_V2_3åœ°å€ä¸ºæ–°åœ°å€ `0x081084612AAdFdbe135A24D933c440CfA2C983d2`

---

## ğŸ“ ç»éªŒæ€»ç»“

### æˆåŠŸå› ç´ 

1. **ä½¿ç”¨å®˜æ–¹shared-configåŒ…** â†’ ä¿è¯åœ°å€æ­£ç¡®æ€§
2. **forge script vs forge create** â†’ é¿å…socket error
3. **åˆ é™¤node_modules** â†’ è§£å†³path too long
4. **è¯¦ç»†çš„broadcastæ—¥å¿—** â†’ æ–¹ä¾¿éªŒè¯éƒ¨ç½²

### é¿å…çš„é—®é¢˜

1. âŒ ç¡¬ç¼–ç åœ°å€ â†’ âœ… ä»npmåŒ…åŠ¨æ€è·å–
2. âŒ ä¾èµ–è¿‡æ—¶docs â†’ âœ… ä½¿ç”¨æœ€æ–°çš„shared-config
3. âŒ forge createå¤±è´¥ â†’ âœ… æ”¹ç”¨forge script
4. âŒ è·¯å¾„è¿‡é•¿ â†’ âœ… ä¸´æ—¶åˆ é™¤node_modules

---

## ğŸ“ éªŒè¯ä¿¡æ¯

### åˆçº¦æ¥å£éªŒè¯

```bash
# æŸ¥çœ‹VERSION
cast call 0x081084612AAdFdbe135A24D933c440CfA2C983d2 \
  "VERSION()(string)" \
  --rpc-url $SEPOLIA_RPC_URL
# è¿”å›: "2.3.0"

# æŸ¥çœ‹DEFAULT_SBT
cast call 0x081084612AAdFdbe135A24D933c440CfA2C983d2 \
  "DEFAULT_SBT()(address)" \
  --rpc-url $SEPOLIA_RPC_URL
# è¿”å›: 0xD1e6BDfb907EacD26FF69a40BBFF9278b1E7Cf5C
```

### Etherscané“¾æ¥

- **åˆçº¦**: https://sepolia.etherscan.io/address/0x081084612AAdFdbe135A24D933c440CfA2C983d2
- **éƒ¨ç½²äº¤æ˜“**: https://sepolia.etherscan.io/tx/0x1b2d3bb268881f2776e48a38d9d73e74b642054ea2a09ae17e65bd879af6c99d
- **EntryPointé…ç½®**: https://sepolia.etherscan.io/tx/0xe30393d1a8b81b14541204be939139ae2091aff28468108d297b6f2e97145f3c
- **aPNTsTokené…ç½®**: https://sepolia.etherscan.io/tx/0xafcb8da281650c1d5adf8cd436411d76f0bf78501e790a2701fe897979a6712f

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-19 19:30
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0
**åˆçº¦ç‰ˆæœ¬**: SuperPaymasterV2_3
**ç½‘ç»œ**: Sepolia Testnet

---

**ç»“è®º**: SuperPaymasterV2_3å·²æˆåŠŸéƒ¨ç½²åˆ°Sepoliaï¼Œä½¿ç”¨äº†ä»@aastar/shared-config v0.3.4è·å–çš„æ­£ç¡®åˆçº¦åœ°å€ã€‚EntryPointå’ŒaPNTsTokenå·²é…ç½®å®Œæˆã€‚ä¸‹ä¸€æ­¥æ˜¯æ³¨å†Œoperatorå¹¶è¿›è¡Œå®Œæ•´çš„gaslessäº¤æ˜“æµ‹è¯•ã€‚
