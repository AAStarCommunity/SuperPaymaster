#!/bin/bash

###############################################################################
# Run All Gasless Transfer Tests
#
# Executes all three test cases sequentially:
# 1. PaymasterV4 + xPNTs
# 2. SuperPaymasterV2 + xPNTs1
# 3. SuperPaymasterV2 + xPNTs2
#
# Configuration is read from /Volumes/UltraDisk/Dev2/aastar/env/.env
###############################################################################

set -e  # Exit on error

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘       Running All Gasless Transfer Test Cases            â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Check if env file exists
ENV_FILE="/Volumes/UltraDisk/Dev2/aastar/env/.env"
if [ ! -f "$ENV_FILE" ]; then
    echo "âŒ Error: Configuration file not found at $ENV_FILE"
    exit 1
fi

echo "âœ… Configuration file found: $ENV_FILE"
echo ""

# Test Case 1
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ§ª Test Case 1: PaymasterV4 + xPNTs"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if node "$SCRIPT_DIR/test-case-1-paymasterv4.js"; then
    echo "âœ… Test Case 1: PASSED"
else
    echo "âŒ Test Case 1: FAILED"
    exit 1
fi
echo ""
echo ""

# Test Case 2
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ§ª Test Case 2: SuperPaymasterV2 + xPNTs1"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if node "$SCRIPT_DIR/test-case-2-superpaymaster-xpnts1.js"; then
    echo "âœ… Test Case 2: PASSED"
else
    echo "âŒ Test Case 2: FAILED"
    exit 1
fi
echo ""
echo ""

# Test Case 3
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ§ª Test Case 3: SuperPaymasterV2 + xPNTs2"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if node "$SCRIPT_DIR/test-case-3-superpaymaster-xpnts2.js"; then
    echo "âœ… Test Case 3: PASSED"
else
    echo "âŒ Test Case 3: FAILED"
    exit 1
fi
echo ""

# Summary
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘              All Tests Completed Successfully!            â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Summary:"
echo "  âœ… Test Case 1: PaymasterV4 + xPNTs"
echo "  âœ… Test Case 2: SuperPaymasterV2 + xPNTs1"
echo "  âœ… Test Case 3: SuperPaymasterV2 + xPNTs2"
echo ""
echo "All gasless transfer tests passed! ğŸ‰"
